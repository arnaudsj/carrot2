<?xml version="1.0" encoding="UTF-8" ?>
<project name="carrot2.common.attributes">
  <path id="attrs.classpath">
      <fileset dir="${carrot2.master.basedir}">
          <include name="tmp/jar/carrot2-core*.jar" />
          <include name="lib/com.thoughtworks.qdox/*.jar" />
          <include name="lib/com.google.collections/*.jar" />
          <include name="lib/org.apache.commons/*.jar" />
          <include name="lib/org.simpleframework.xml/*.jar" />
          <include name="lib/org.codehaus.woodstox/*.jar" />
      </fileset>
  </path>

  <property name="common.attribute.names.source.path"
            location="${carrot2.master.basedir}/core/carrot2-core/src/org/carrot2/core/attribute/AttributeNames.java" />

  <target name="tasks">
    <taskdef name="metadata-serializer" 
             classname="org.carrot2.util.attribute.BindableMetadataSerializerTask" 
             classpathref="attrs.classpath" 
             loaderRef="attrs.classloader" />

    <macrodef name="attributes-xml">
      <attribute name="java.source" />
      <sequential>
        <switchClassLoader loaderRef="attrs.classloader">
          <mkdir dir="${lingo3g.master.basedir}/tmp" />

          <metadata-serializer destdir="@{java.source}">
            <commonMetadata>
                <path location="${common.attribute.names.source.path}" />
            </commonMetadata>

            <fileset dir="@{java.source}">
                <include name="**/*.java" />

                <modified update="true" cache="propertyfile" algorithm="digest" comparator="equal">
                    <param name="cache.cachefile"
                        value="${lingo3g.master.basedir}/tmp/attrs-cache.properties"/>
                    <param name="algorithm.algorithm" value="MD5" />
                </modified>
            </fileset>
          </metadata-serializer>
        </switchClassLoader>
      </sequential>
    </macrodef>
  </target>
</project>
